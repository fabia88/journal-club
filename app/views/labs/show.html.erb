<div class="container">
  <div class="row">

    <div class="col-xs-4">
      <h3>Lab memberships</h3>
      <%= link_to "Invite a user", new_lab_membership_path(@lab) %>
      <% @lab.memberships.each do |membership| %>
      <div class="product">
        <img src="http://lorempixel.com/100/100/abstract/1/" alt="lorempixel" class="product-image hidden-xs">
        <div class='product-body'>
          <h3><%= membership.user.first_name %> <%= membership.user.last_name %></h3>
          <p>Status: <strong><%= membership.status %></strong></p>
          <p><%= membership.user.job_description %></p>
          <p><%= membership.user.education %></p>
          <%= link_to "View profile", user_path(membership.user) %>
        </div>
        <ul class="list-inline product-controls hidden-sm hidden-xs">
          <!-- Conditional for "Accept/Deny" -->
          <% if current_user == membership.user && membership.user.joined_labs.include?(@lab) && membership.status == "pending" %>
          <%= link_to "Accept", accept_membership_path(membership), method: "patch" %>
          <%= link_to "Deny", deny_membership_path(membership), method: "patch" %>
          <!-- Conditional for "Cancel" -->
          <% elsif @lab.memberships.find_by(user: current_user) && membership.user.joined_labs.include?(@lab) && membership.status == "pending" %>
          <%= link_to "Cancel", cancel_membership_path(membership), method: "patch" %>
          <% end %>
        </ul>
      </div>
      <% end %>
    </div>

    <div class="col-xs-8">
      <!-- Lab banner -->
      <h2><%= @lab.name %></h2>
      <div class="banner banner-40vh" style="background-image: url('https://static.pexels.com/photos/267885/pexels-photo-267885.jpeg');">
      </div>
      <!-- Lab links -->
      <div>
        <%= link_to "Edit lab", edit_lab_path(@lab) %>
        <!-- Conditional for "Archive lab" -->
        <% if current_user.created_labs.include?(@lab) %>
        <%= link_to "Archive lab", archive_lab_path(@lab), method: :patch, data: { confirm: "Are you sure?" } %>
        <% end %>
      </div>
      <!-- Lab description -->
      <div>
        <h3>Description</h3>
        <p><%= @lab.description %></p>
        <h4>
          Last updated: <%= @lab.updated_at.to_formatted_s(:short) %> | Created at: <%= @lab.created_at.to_formatted_s(:short) %>
        </h4>
      </div>
      <!-- Index posts -->
      <div>
        <h3>Posts</h3>
        <% @lab.posts.each do |post|%>
        <div class="message">
          <img class="avatar-large hidden-xs" src="http://lorempixel.com/100/100/abstract/1/">
          <div class="message-name">
            <h3><%= post.user.first_name %> <%= post.user.last_name %></h3>
            <p><%= post.created_at %></p>
          </div>
          <div class="message-body">
            <p><%= post.content %></p>
          </div>
        </div>
        <!-- If post has paper_id linked -->
        <% if post.paper %>
        <div class="product">
          <div class='product-body'>
            <h3><%= post.paper.title %></h3>
            <%= link_to "Go to paper", paper_path(post.paper) %>
          </div>
        </div>
        <% end %>
        <% end %>
      </div>
      <!-- Create post -->
      <div>
        <h3>New Post</h3>
        <div class="form-group">
          <%= simple_form_for([@lab, @post]) do |f|%>
          <%= f.input :content, class: "form-control" %>
          <%= f.button :submit, class: "btn btn-primary" %>
          <% end %>
        </div>
      </div>
    </div>

  </div>
</div>
